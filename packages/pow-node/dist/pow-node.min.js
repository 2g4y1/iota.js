"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@iota/crypto.js"),r=require("@iota/iota.js"),t=require("os"),o=require("path"),s=require("worker_threads");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=a(t),i=a(o);function u(e,t,o){return r.PowHelper.performPow(e,t,o)}if(s.workerData&&s.parentPort){const e=u(s.workerData.powDigest,s.workerData.targetZeros,s.workerData.startIndex);s.parentPort.postMessage(e)}exports.NodePowProvider=class{constructor(e){this._numCpus=null!=e?e:n.default.cpus().length}async pow(t,o){const a=t.slice(0,-8),n=e.Blake2b.sum256(a),u=r.PowHelper.calculateTargetZeros(t,o);return new Promise(((e,r)=>{const t=BigInt(0x10000000000000000)/BigInt(this._numCpus),o=[];let a=!1;for(let p=0;p<this._numCpus;p++){const c=new s.Worker(i.default.join(__dirname,"pow-node.js"),{workerData:{powDigest:n,targetZeros:u,startIndex:(t*BigInt(p)).toString()}});o.push(c),c.on("message",(async r=>{a=!0;for(let e=0;e<o.length;e++)await o[e].terminate();e(r)})),c.on("error",(e=>{r(e)})),c.on("exit",(e=>{a||0===e||r(new Error(`Worker stopped with exit code ${e}`))}))}}))}},exports.doPow=u;