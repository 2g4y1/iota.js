"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@iota/iota.js"),r=require("os"),t=require("path"),o=require("worker_threads");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(r),n=s(t);function i(r,t,o){return e.PowHelper.performPow(r,t,o)}if(o.workerData&&o.parentPort){const e=i(o.workerData.powDigest,o.workerData.targetZeros,o.workerData.startIndex);o.parentPort.postMessage(e)}exports.NodePowProvider=class{constructor(e){this._numCpus=null!=e?e:a.default.cpus().length}async pow(r,t){const s=r.slice(0,-8),a=e.Blake2b.sum256(s),i=e.PowHelper.calculateTargetZeros(r,t);return new Promise(((e,r)=>{const t=BigInt(0x10000000000000000)/BigInt(this._numCpus),s=[];let u=!1;for(let p=0;p<this._numCpus;p++){const l=new o.Worker(n.default.join(__dirname,"pow-node.js"),{workerData:{powDigest:a,targetZeros:i,startIndex:(t*BigInt(p)).toString()}});s.push(l),l.on("message",(async r=>{u=!0;for(let e=0;e<s.length;e++)await s[e].terminate();e(r)})),l.on("error",(e=>{r(e)})),l.on("exit",(e=>{u||0===e||r(new Error(`Worker stopped with exit code ${e}`))}))}}))}},exports.doPow=i;