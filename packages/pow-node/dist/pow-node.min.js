"use strict";var e=require("@iota/iota.js"),t=require("os"),o=require("path"),r=require("worker_threads");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=n(e),i=n(t),u=n(o),d=n(r),l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f={},c={},p=l&&l.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,a){function i(e){try{d(r.next(e))}catch(e){a(e)}}function u(e){try{d(r.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}d((r=r.apply(e,t||[])).next())}))},w=l&&l.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(c,"__esModule",{value:!0}),c.NodePowProvider=void 0;const _=a.default,v=w(i.default),g=w(u.default),h=d.default;c.NodePowProvider=class{constructor(e){this._numCpus=null!=e?e:v.default.cpus().length}pow(e,t){return p(this,void 0,void 0,(function*(){const o=e.slice(0,-8),r=_.Blake2b.sum256(o),n=_.PowHelper.calculateTargetZeros(e,t);return new Promise(((e,t)=>{const o=BigInt(0x10000000000000000)/BigInt(this._numCpus),a=[];let i=!1;for(let u=0;u<this._numCpus;u++){const d=new h.Worker(g.default.join(__dirname,"pow-node.js"),{workerData:{powDigest:r,targetZeros:n,startIndex:o*BigInt(u)}});a.push(d),d.on("message",(t=>p(this,void 0,void 0,(function*(){i=!0;for(let e=0;e<a.length;e++)yield a[e].terminate();e(BigInt(t))})))),d.on("error",(e=>{t(e)})),d.on("exit",(e=>{i||0===e||t(new Error(`Worker stopped with exit code ${e}`))}))}}))}))}};var P={};Object.defineProperty(P,"__esModule",{value:!0}),P.doPow=void 0;const y=a.default,b=d.default;function m(e,t,o){return y.PowHelper.performPow(e,t,o)}if(P.doPow=m,b.workerData&&b.parentPort){const e=m(b.workerData.powDigest,b.workerData.targetZeros,b.workerData.startIndex);b.parentPort.postMessage(e.toString())}var j,k,x;j=f,k=l&&l.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),x=l&&l.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||k(t,e,o)},Object.defineProperty(j,"__esModule",{value:!0}),x(c,j),x(P,j);var O=s(f);module.exports=O;